!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t,e,i,n){"use strict";function o(e,i){this.element=e,this.$element=t(e),this.options=t.extend({},l,i),this.prototype=this.$element.data(this.options.prototypeAttr),this.index=this.$element.find(this.options.selector).length,this._defaults=l,this._name=s,this.init()}var s="collection",l={selector:"> div",wrapper:!1,prototypeName:"__name__",prototypeAttr:"prototype",btnAddClass:"button_add",btnAddText:"[+]",btnDeleteClass:"button_delete",btnDeleteText:"[-]",allowAdd:!0,allowDelete:!0,onAdded:function(){},onDeleted:function(){},min:1,max:100};o.prototype={init:function(){this._registerEventHandlers(),this.$element.trigger(s+".initialized")},add:function(){var e=t("<a />").addClass(this.options.btnAddClass).text(this.options.btnAddText).attr("href","#");this.options.allowAdd===!0&&this.index<this.options.max?(this.$element.find("."+this.options.btnAddClass).remove(),this.$element.append(e)):this.$element.find("."+this.options.btnAddClass).remove(),e.on("click",t.proxy(function(e){var i=new RegExp(this.options.prototypeName,"g"),n=this.$element.data(this.options.prototypeAttr).replace(i,this.index);this.options.wrapper!==!1&&(n="<"+this.options.wrapper+">"+n+"</"+this.options.wrapper+">"),this.$element.append(n),this.options.onAdded.call(this,this.$element,t(n)),e.preventDefault(),this.$element.trigger(s+".changed")},this))},"delete":function(e){var i=t("<a />").addClass(this.options.btnDeleteClass).text(this.options.btnDeleteText).attr("href","#");this.options.allowDelete===!0&&this.index>this.options.min?(e.find("."+this.options.btnDeleteClass).remove(),e.append(i)):this.index===this.options.min&&e.find("."+this.options.btnDeleteClass).remove(),i.on("click",t.proxy(function(t){this.options.onDeleted.call(this,this.$element,e),e.remove(),t.preventDefault(),this.$element.trigger(s+".changed")},this))},prepareHTML:function(){this.add();var e=this;this.$element.find(this.options.selector).each(function(){e["delete"].apply(e,[t(this)])})},_registerEventHandlers:function(){this.$element.on(s+".initialized",t.proxy(this.onCollectionInitialized,this)),this.$element.on(s+".changed",t.proxy(this.onCollectionChanged,this))},onCollectionInitialized:function(){this.prepareHTML()},onCollectionChanged:function(){this.index=this.$element.find(this.options.selector).length,this.prepareHTML()}},t.fn[s]=function(e){var i=arguments;if(e===n||"object"==typeof e)return this.each(function(){t.data(this,"plugin_"+s)||t.data(this,"plugin_"+s,new o(this,e))});if("string"==typeof e&&"_"!==e[0]&&"init"!==e){var l;return this.each(function(){var n=t.data(this,"plugin_"+s);n instanceof Plugin&&"function"==typeof n[e]&&(l=n[e].apply(n,Array.prototype.slice.call(i,1))),"destroy"===e&&t.data(this,"plugin_"+s,null)}),l!==n?l:this}}});